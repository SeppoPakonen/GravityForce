-- Fracht
-- init script

dofile("./levels/libeff.sc")

bases:add( 0, PLAYER_BASE,  1023,   1543 )
bases:add( 1, PLAYER_BASE,  1250,   1544 )

objects:add( 0, OBJ_PILE,   1093,  1535 )
objects:add( 1, OBJ_PILE,   1322,  1535 )

---Fracht Mod------------------anfang-------------------------------------------------------

    cargo_base = {}
    cargo_base[1] = bases:add(2, CARGO_BASE, 710, 1309)
    cargo_base[2] = bases:add(3, CARGO_BASE, 1115, 1309)
    cargo_base[3] = bases:add(4, CARGO_BASE, 1534, 1309)
    cargo_base[4] = bases:add(5, CARGO_BASE, 2167, 1980)
    cargo_base[5] = bases:add(6, CARGO_BASE, 70, 1930)
    cargo_base[6] = bases:add(7, CARGO_BASE, 276, 1210)
    cargo_base[7] = bases:add(8, CARGO_BASE, 559, 732)
    cargo_base[8] = bases:add(9, CARGO_BASE, 1965, 1215)
    cargo_base[9] = bases:add(10, CARGO_BASE, 1680, 730)
    cargo_base[10] = bases:add(11, CARGO_BASE, 566, 252)
    cargo_base[11] = bases:add(12, CARGO_BASE, 1695, 249)
    cargo_base[12] = bases:add(13, CARGO_BASE, 70, 394)
    cargo_base[13] = bases:add(14, CARGO_BASE, 2175, 395)

    local s

    for s = 1, 13 do
      cargo_base[s]:set_cargo_type(CARGO_NORMAL)
      cargo_base[s]:set_cargo_weight(10)
    end

    cargo_base[2]:set_cargo_weight(15)

myosdr = playmap[1].osd:add( 15, 50, 7, 251, 21, OSDBIT_SCREEN )
myosdr2 = playmap[2].osd:add( 16, 50, 7, 251, 21, OSDBIT_SCREEN )

myosd = playmap[1].osd:add( 17, 50, 7, 250, 21, OSDBIT_SCREEN )
myosd2 = playmap[2].osd:add( 18, 50, 7, 250, 21, OSDBIT_SCREEN )

myosdr:draw_rectangle()
myosdr2:draw_rectangle()

cargoplayer = {}
cargoplayer[ 1 ] = 0
cargoplayer[ 2 ] = 0
col = globals.col_yellow
col2 = globals.col_yellow

function refill_bases()
  local n

  for n = 1, 13 do
    cargo_base[n]:set_cargo_type(CARGO_NORMAL)
    cargo_base[n]:set_cargo_weight(10)
  end

  cargo_base[2]:set_cargo_weight(15)

end

function hook_player_returns_cargo_0(pl)

   local cargo_space = pl:get_weight()
   local plnum = get_player_nr_by_sig( pl:get_sig() ) + 1

   if (plnum == 1) then
   cargoplayer[1] = cargoplayer[1] + cargo_space

     if (cargoplayer[1] >= 150) then
     col = globals.col_red
     end

       if (cargoplayer[1] >= 200) then
       player[1]:inc_bonus(3000)
       globals.exit_level = 1
       end

   myosd:draw_filled_rectangle(col, 1, 1, cargoplayer[1], 19)

   end

   if (plnum == 2) then
   cargoplayer[2] = cargoplayer[2] + cargo_space

     if (cargoplayer[2] >= 150) then
     col2 = globals.col_red
     end

       if (cargoplayer[2] >= 200) then
       player[2]:inc_bonus(3000)
       globals.exit_level = 1
       end

   myosd2:draw_filled_rectangle(col2, 1, 1, cargoplayer[2], 19)

   end

  if (player[1]:get_weight() > 0 and player[2]:get_weight() == 0) or (player[2]:get_weight() > 0 and player[1]:get_weight() == 0) then
  local n
  local leer = 1
  for n = 1, 13 do
    if cargo_base[n]:get_cargo_type() ~= CARGO_NONE then
      leer = nil
      break
    end
  end
    if leer then
      refill_bases()
    end
  end
end

function hook_player_dead_0(pl)
  if (pl:get_weight() > 0 and player[2]:get_weight() == 0) or (pl:get_weight() > 0 and player[1]:get_weight() == 0) then
  local n
  local leer = 1
  for n = 1, 13 do
    if cargo_base[n]:get_cargo_type() ~= CARGO_NONE then
      leer = nil
      break
    end
  end
    if leer then
      refill_bases()
    end
  end
end
---Fracht Mod------------------ende---------------------------------------------------------
