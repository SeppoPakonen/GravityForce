-- Weapon Storage
-- Initscript

-- Ein wenig Peripherie in die Landschaft

if (VERSION >= 0.9) then
  dofile("./levels/compat.lua")
end

mybase = bases:add(  0, PLAYER_BASE, 1925, 3224 )
mybase = bases:add(  1, PLAYER_BASE, 2203, 3227 )

nr = {}

nr[1] = bases:add(  2, CARGO_BASE, 2055, 2838 ) -- am Anfang
nr[2] = bases:add(  3, CARGO_BASE, 2057, 1881 ) -- das Zentrum
nr[3] = bases:add(  4, CARGO_BASE, 1383, 2408 ) -- links oben
nr[4] = bases:add(  5, CARGO_BASE, 2741, 2410 ) -- rechts oben
nr[5] = bases:add(  6, CARGO_BASE, 3015, 2844 ) -- rechts
nr[6] = bases:add(  7, CARGO_BASE, 1096, 2843 ) -- links
nr[7] = bases:add(  8, CARGO_BASE, 1102, 3606 ) -- links unten
nr[8] = bases:add(  9, CARGO_BASE, 3022, 3606 ) -- rechts unten
nr[9] = bases:add( 10, CARGO_BASE, 1703, 1547 ) -- spitze links
nr[10] = bases:add( 11, CARGO_BASE, 2379, 1544 ) -- spitze rechts

myob = objects:add_special(  0, SPOBJ_BUMPL, 1815, 1595 )
myob = objects:add_special(  1, SPOBJ_BUMPR, 2356, 1831 )
myob = objects:add_special(  2, SPOBJ_BUMPR, 2358, 1660 )
myob = objects:add_special(  3, SPOBJ_BUMPL, 1816, 1764 )
myob = objects:add_special(  4, SPOBJ_BUMPD, 2008, 1156 )
myob = objects:add_special(  5, SPOBJ_BUMPD, 2087, 1156 )

myen = enemies:add(1,E_SHIP_BIGRED,2014,2595,0,0,0,0,0,0)
myen.wp:add( 2014, 2595, 0.5, 20 )
myen.wp:add( 2100, 2619, 0.5, 20 )

-- Und hurtig ein paar Bilderchen laden

AMMO_SINGLE  = images:load("./bitmap/w_single.bmp")
AMMO_DOUBLE  = images:load("./bitmap/w_double.bmp")
AMMO_BOMB    = images:load("./bitmap/w_bomb.bmp")
AMMO_BIGBOMB = images:load("./bitmap/w_bigbmb.bmp")
AMMO_ROCKET  = images:load("./bitmap/w_rocket.bmp")
AMMO_MINE    = images:load("./bitmap/w_mine.bmp")
AMMO_FREEZER = images:load("./bitmap/w_freeze.bmp")
AMMO_SHRINKER= images:load("./bitmap/w_shrink.bmp")
AMMO_PROBE   = images:load("./bitmap/w_probe.bmp")
AMMO_GAS     = images:load("./bitmap/w_gas.bmp")

AMMO_SINGLE  = objects:add(1001,AMMO_SINGLE,1,1)
AMMO_DOUBLE  = objects:add(1002,AMMO_DOUBLE,20,1)
AMMO_BOMB    = objects:add(1003,AMMO_BOMB,40,1)
AMMO_BIGBOMB = objects:add(1004,AMMO_BIGBOMB,60,1)
AMMO_ROCKET  = objects:add(1005,AMMO_ROCKET,80,1)
AMMO_MINE    = objects:add(1006,AMMO_MINE,100,1)
AMMO_FREEZER = objects:add(1007,AMMO_FREEZER,120,1)
AMMO_SHRINKER= objects:add(1008,AMMO_SHRINKER,140,1)
AMMO_PROBE   = objects:add(1009,AMMO_PROBE,160,1)
AMMO_GAS     = objects:add(1010,AMMO_GAS,180,1)

function create_crates()
nr[1]:set_cargo_type(CARGO_OBJECT)
nr[1]:set_cargo_object(AMMO_SINGLE)
nr[1]:set_cargo_weight(1)
nr[1]:set_cargo_name("Single Blaster")
nr[2]:set_cargo_type(CARGO_OBJECT)
nr[2]:set_cargo_object(AMMO_DOUBLE)
nr[2]:set_cargo_weight(2)
nr[2]:set_cargo_name("Double Blaster")
nr[3]:set_cargo_type(CARGO_OBJECT)
nr[3]:set_cargo_object(AMMO_BOMB)
nr[3]:set_cargo_weight(3)
nr[3]:set_cargo_name("Bomben")
nr[4]:set_cargo_type(CARGO_OBJECT)
nr[4]:set_cargo_object(AMMO_BIGBOMB)
nr[4]:set_cargo_weight(4)
nr[4]:set_cargo_name("Bigbombs")
nr[5]:set_cargo_type(CARGO_OBJECT)
nr[5]:set_cargo_object(AMMO_ROCKET)
nr[5]:set_cargo_weight(5)
nr[5]:set_cargo_name("Raketen")
nr[6]:set_cargo_type(CARGO_OBJECT)
nr[6]:set_cargo_object(AMMO_MINE)
nr[6]:set_cargo_weight(6)
nr[6]:set_cargo_name("Minen")
nr[7]:set_cargo_type(CARGO_OBJECT)
nr[7]:set_cargo_object(AMMO_FREEZER)
nr[7]:set_cargo_weight(7)
nr[7]:set_cargo_name("Freezer")
nr[8]:set_cargo_type(CARGO_OBJECT)
nr[8]:set_cargo_object(AMMO_SHRINKER)
nr[8]:set_cargo_weight(8)
nr[8]:set_cargo_name("Shrinker")
nr[9]:set_cargo_type(CARGO_OBJECT)
nr[9]:set_cargo_object(AMMO_PROBE)
nr[9]:set_cargo_weight(9)
nr[9]:set_cargo_name("Killer-Sonden")
nr[10]:set_cargo_type(CARGO_OBJECT)
nr[10]:set_cargo_object(AMMO_GAS)
nr[10]:set_cargo_weight(10)
nr[10]:set_cargo_name("Duselbomben")
end

create_crates()

slotzaehler1  = 0
slotzaehler2  = 0
pickupzaehler = 0

local j
for j = 0, 5 do
  player[1]:set_weapon(j, W_NONE, 0, 1)
  player[2]:set_weapon(j, W_NONE, 0, 1)
end

slots1 = {}
slots2 = {}

y = 0

function hook_player_takes_cargo_0(pl, ba)
  if pl:get_sig() == player[1]:get_sig() then y = slotzaehler1 else y = slotzaehler2 end
  if ba:get_nr() == nr[1]:get_nr() then
   pl:set_weapon(y, W_SINGLE, -1, 0)
  elseif ba:get_nr() == nr[2]:get_nr() then
    pl:set_weapon(y, W_DOUBLE, 120, 0)
  elseif ba:get_nr() == nr[3]:get_nr() then
    pl:set_weapon(y, W_BOMB, 15, 30)
  elseif ba:get_nr() == nr[4]:get_nr() then
    pl:set_weapon(y, W_BIGBOMB, 15, 45)
  elseif ba:get_nr() == nr[5]:get_nr() then
    pl:set_weapon(y, W_ROCKET, 12, 45)
  elseif ba:get_nr() == nr[6]:get_nr() then
    pl:set_weapon(y, W_MINE, 30, 20)
  elseif ba:get_nr() == nr[7]:get_nr() then
    pl:set_weapon(y, W_FREEZER, 10, 60)
  elseif ba:get_nr() == nr[8]:get_nr() then
    pl:set_weapon(y, W_SHRINKER, 10, 60)
  elseif ba:get_nr() == nr[9]:get_nr() then
    pl:set_weapon(y, W_PROBE, 10, 120)
  elseif ba:get_nr() == nr[10]:get_nr() then
    pl:set_weapon(y, W_GAS, 10, 60)
  end
  pl:set_active_weapon(slotzaehler1)
  pl:set_active_weapon(pl:get_active_weapon()) -- diente in 0.82 zum Panel-Update :)
  pl:set_weight(0)
  pickupzaehler = pickupzaehler + 1
  if pickupzaehler == 9 then
    create_crates()
    pickupzaehler = 0
    gsound:play_sound(SOUND_BEAM_SHIP, 100) -- Geraeusch signalisiert
    gsound:play_sound(SOUND_BEAM_SHIP, 100) -- neu erscheinende Pakete,
    gsound:play_sound(SOUND_BEAM_SHIP, 100) -- wenn 9 von 10 gesammelt.
  end
end