-- QD05: Black Hole
-- init script

-- set home coordinates of players

player[1]:set_home_x(100+150)
player[1]:set_home_y(100+150)

player[2]:set_home_x(100+640-150)
player[2]:set_home_y(100+150)

-- create "black hole" (strength: 20)
local st = 50
if globals.activate_extra == 1 then st = 75 end
objects:add_special(0, SPOBJ_GRAVTRAP, 100+320, 100+200, st)


-- set some globals for script

start_x = 100
start_y = 100
end_x   = 100 + 640
end_y   = 100 + 480 - 56

player_width = player[1]:get_width()
player_height = player[1]:get_height()


-- define required functions

function player_screen_check(a)
  if (player[a]:get_x() > end_x) then 
    player[a]:set_x(start_x - player_width)
  elseif (player[a]:get_x() < start_x - player_width) then
    player[a]:set_x(end_x)
  end
  
  if (player[a]:get_y() > end_y) then
    player[a]:set_y(start_y - player_height)  
  elseif (player[a]:get_y() < start_y - player_height) then
    player[a]:set_y(end_y)
  end
end

function bullets_screen_check()
  local tb = effects.bullets:get_first()
  local sx = start_x
  local sy = start_y
  local ex = end_x
  local ey = end_y
  
  while (tb) do
    local x = tb:get_x()
    local y = tb:get_y()
    local next = tb:get_next()

    if (x > ex) then 
      tb:set_x(sx)
    elseif (x < sx) then
      tb:set_x(ex)
    end
      
    if (y > ey) then 
      tb:set_y(sy)
    elseif (y < sy) then
      tb:set_y(ey)
    end
    
    tb = next
  end
end
