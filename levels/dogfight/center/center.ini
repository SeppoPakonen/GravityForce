-- Center
-- init script

-- Basen
bases:add(  0, PLAYER_BASE,  546, 2269 )
bases:add(  1, PLAYER_BASE, 1704,  203 )
bases:add(  2, PLAYER_BASE, 1706, 2266 )
bases:add(  3, PLAYER_BASE,  560,  204 )

-- Landeplatz für Extras
bases:add( 4, ENEMY_S_BASE, 1160, 1168 )
objects:add( 2, OBJ_PILE, 1150, 1155 )
objects:add( 3, OBJ_PILE, 1197, 1155 )

--objects:add( 4, OBJ_DOORH2, 1105,  560 )
--objects:add( 5, OBJ_DOORH2, 1105,  795 )

-- Obere Türen
objects:add( 4, OBJ_DOORH, 1135,  570 )
objects:add( 5, OBJ_DOORH, 1138,  785 )
objects:add(12, OBJ_SWITCHU, 1120,  535 )
objects:add(13, OBJ_SWITCHD, 1220,  810 )

-- Untere Türen
objects:add( 6, OBJ_DOORH, 1135, 1570 )
objects:add( 7, OBJ_DOORH, 1138, 1785 )
objects:add(14, OBJ_SWITCHU, 1120, 1542 )
objects:add(15, OBJ_SWITCHD, 1220, 1817 )

-- Linke Türen
objects:add( 8, OBJ_DOORV,  570, 1140 )
objects:add( 9, OBJ_DOORV,  775, 1140 )
objects:add(16, OBJ_SWITCHL,  530, 1220 )
objects:add(17, OBJ_SWITCHR,  807, 1120 )

-- Rechte Türen
objects:add(10, OBJ_DOORV, 1570, 1140 )
objects:add(11, OBJ_DOORV, 1785, 1140 )
objects:add(18, OBJ_SWITCHL, 1539, 1220 )
objects:add(19, OBJ_SWITCHR, 1817, 1120 )

objects:add_special( 20, SPOBJ_EXTRA, 1170, 1150, 30 )

--objects:add_special( 31, SPOBJ_TELEPORT1,  120,  120, 32)
--objects:add_special( 32, SPOBJ_TELEPORT1, 1720, 1580, 31)
--objects:add_special( 33, SPOBJ_TELEPORT1,  120, 1580, 34)
--objects:add_special( 34, SPOBJ_TELEPORT1, 1720,  120, 33)


-- Extraspender ---------------------------------------------------

myextracounter = 0

function check_extra()
  myextra = objects:get_spobject(20)
  if (myextra == nil) then
    myextracounter = myextracounter + 1
    if (myextracounter >= 60*15) then
      objects:add_special( 20, SPOBJ_EXTRA, 1170, 1150, 30 )
      myextracounter = 0
    end
  end
end


-- Türsteuerung ---------------------------------------------------

swstats = {}
swcount = {}

for sw = 12, 19 do
  switch = objects:get_object(sw)
  swstats[sw-11] = switch:get_dispframe()
  swcount[sw-11] = 0
end

function switch_on(sw)
  switch = objects:get_object(sw)
  switch:set_dispframe(1)
  swstats[sw-11] = switch:get_dispframe()
end

function switch_off(sw)
  switch = objects:get_object(sw)
  switch:set_dispframe(0)
  swstats[sw-11] = switch:get_dispframe()
  swcount[sw-11] = 0
end

function open_door(dr)
  door = objects:get_object(dr)
  door:set_dispframe(0)
  door:set_startframe(0)
  door:set_maxframe(0)
end

function close_door(dr)
  door = objects:get_object(dr)
  door:set_startframe(1)
  door:set_maxframe(3)
end

function check_switches()
  for sw = 12, 19 do
    switch = objects:get_object(sw)
    active = switch:get_dispframe()
    if (swstats[sw-11] ~= active) then
      if (active == 1) then
        if (sw == 12) or (sw == 13) then
          switch_on(12)
          switch_on(13)
          open_door(4)
          open_door(5)
        elseif (sw == 14) or (sw == 15) then
          switch_on(14)
          switch_on(15)
          open_door(6)
          open_door(7)
        elseif (sw == 16) or (sw == 17) then
          switch_on(16)
          switch_on(17)
          open_door(8)
          open_door(9)
        elseif (sw == 18) or (sw == 19) then
          switch_on(18)
          switch_on(19)
          open_door(10)
          open_door(11)
        end
        swcount[sw-11] = 900
      else
        if (sw == 12) or (sw == 13) then
          switch_off(12)
          switch_off(13)
          close_door(4)
          close_door(5)
        elseif (sw == 14) or (sw == 15) then
          switch_off(14)
          switch_off(15)
          close_door(6)
          close_door(7)
        elseif (sw == 16) or (sw == 17) then
          switch_off(16)
          switch_off(17)
          close_door(8)
          close_door(9)
        elseif (sw == 18) or (sw == 19) then
          switch_off(18)
          switch_off(19)
          close_door(10)
          close_door(11)
        end
      end
    end

    if swcount[sw-11] > 0 then
      swcount[sw-11] = swcount[sw-11]-1
      if swcount[sw-11] == 1 then
        if (sw == 12) or (sw == 13) then
          switch_off(12)
          switch_off(13)
          close_door(4)
          close_door(5)
        elseif (sw == 14) or (sw == 15) then
          switch_off(14)
          switch_off(15)
          close_door(6)
          close_door(7)
        elseif (sw == 16) or (sw == 17) then
          switch_off(16)
          switch_off(17)
          close_door(8)
          close_door(9)
        elseif (sw == 18) or (sw == 19) then
          switch_off(18)
          switch_off(19)
          close_door(10)
          close_door(11)
        end
      end
    end
  end
end
