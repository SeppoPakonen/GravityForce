-- INI-Datei
-- Remake von Gravity Force Level 5
-- von Frapela
-- 13.08.2003

player[1]:load_image(LEVEL_DIR .. "./frapela/piranha.bmp")
player[1]:set_wall_shield(0)
player[1]:set_wall_shield_recharge(0)
player[1]:set_shield(2)
player[1]:set_max_shield(2)
player[1]:set_shield_recharge(0.01)
player[1]:set_hull(1)
player[1]:set_max_hull(1)
player[1]:set_hull_repair(0)
player[1]:set_turn_speed(3)
player[1]:set_max_speed(7)
player[1]:set_player_acc(0.03)
player[1]:set_fuel_dec(0.02)
player[1]:set_extra_power(0)
player[1]:set_extra_recharge(0)
function hook_player_respawn_0(pl)
  pl:set_wall_shield(0)
  pl:set_wall_shield_recharge(0)
  pl:set_shield(2)
  pl:set_max_shield(2)
  pl:set_shield_recharge(0.01)
  pl:set_hull(1)
  pl:set_max_hull(1)
  pl:set_hull_repair(0)
  pl:set_turn_speed(3)
  pl:set_max_speed(7)
  pl:set_player_acc(0.03)
  pl:set_fuel_dec(0.02)
  pl:set_extra_power(0)
  pl:set_extra_recharge(0)
  tuer_1:set_maxframe(3)
  tuer_1:set_startframe(1)
  tuer_1:set_dispframe(1)
  tuer_2:set_maxframe(3)
  tuer_2:set_startframe(1)
  tuer_2:set_dispframe(1)
  schalter_1:set_dispframe(0)
  schalter_2:set_dispframe(0)
  letzter_zustand_1 = schalter_1:get_dispframe()
  letzter_zustand_2 = schalter_2:get_dispframe()
end

local n
for n = 0, player[1]:get_avail_weapon_slots() do
  player[1]:deactivate_weapon_slot(n)
  local waffenschacht   = player[1]:get_weapon_slot(n)
  waffenschacht.type    = 0
  waffenschacht.active  = 0
  waffenschacht.bullets = 0
  waffenschacht.reload  = 0
  player[1]:set_weapon_slot(n, waffenschacht)
end
local waffenschacht   = player[1]:get_weapon_slot(0)
waffenschacht.type    = W_SINGLE
waffenschacht.active  = 1
waffenschacht.bullets = -1
waffenschacht.reload  = -1
player[1]:set_weapon_slot(0, waffenschacht)
player[1]:set_active_weapon( 0 )
function hook_enemy_dead_0(en)
  if en:get_type() == E_SHIP_BLUE1 then
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2, -2,  0, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2, -1, -1, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2,  0, -2, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2,  1, -1, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2,  2,  0, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2,  1,  1, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2,  0,  2, 1, 0) 
    effects.bullets:add( W_SINGLE, 0, en:get_nr(), en:get_x()+en:get_width()/2, en:get_y()+en:get_height()/2, -1,  1, 1, 0) 
  end
end

myob = objects:add( 53, OBJ_MAN1,  901, 1343 )
munition_BOMB_bild   = images:load("./frapela/w_bomb.bmp")
munition_DOUBLE_bild = images:load("./frapela/w_double.bmp")
fuel_bild            = images:load("./frapela/fuel.bmp")
munition_BOMB        = objects:add( 50, munition_BOMB_bild,   4000,  1 )
munition_DOUBLE      = objects:add( 51, munition_DOUBLE_bild, 4000, 25 )
fuel                 = objects:add( 52, fuel_bild,            4000, 50 )
MR_RELASH            = objects:add( 53, OBJ_MAN1,             4000, 75 )

mybase = bases:add(  0, PLAYER_BASE,    745, 1784 )
fracht = bases:add(  1, ENEMY_S_BASE,   495, 1599 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(munition_DOUBLE)
fracht:set_cargo_weight(1)
if (LANGUAGE == LANG_DE) then
  fracht:set_cargo_name("Doppelschuss")
else
  fracht:set_cargo_name("Double Blaster")
end
fracht = bases:add(  2, ENEMY_S_BASE,    87, 1644 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(munition_BOMB)
fracht:set_cargo_weight(1)
if (LANGUAGE == LANG_DE) then
  fracht:set_cargo_name("Bomben")
else
  fracht:set_cargo_name("Bombs")
end
fracht = bases:add(  3, ENEMY_S_BASE,   322, 1211 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(munition_BOMB)
fracht:set_cargo_weight(1)
if (LANGUAGE == LANG_DE) then
  fracht:set_cargo_name("Bomben")
else
  fracht:set_cargo_name("Bombs")
end
fracht = bases:add(  4, ENEMY_S_BASE,   325,  540 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(munition_DOUBLE)
fracht:set_cargo_weight(1)
if (LANGUAGE == LANG_DE) then
  fracht:set_cargo_name("Doppelschuss")
else
  fracht:set_cargo_name("Double Blaster")
end
fracht = bases:add(  5, ENEMY_S_BASE,  2660,  444 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(fuel)
fracht:set_cargo_weight(1)
if (LANGUAGE == LANG_DE) then
  fracht:set_cargo_name("Treibstoff")
else
  fracht:set_cargo_name("Fuel")
end
myob = objects:add(  0, OBJ_BUILDING2, 2497,  917 )
fracht = bases:add(  6, ENEMY_S_BASE,  2510,  918 )
fracht:set_cargo_type(CARGO_OBJECT)
fracht:set_cargo_object(MR_RELASH)
fracht:set_cargo_weight(5)
fracht:set_cargo_name("Mr. Relash")

dofile("./levels/libcargo.sc")
init_cargo()
function hook_player_returns_cargo_0(pl)
  check_cargo_return(pl)
  if (__cargo_weight > 0) then
    player[1]:set_mission_status(1)
  end
end
function hook_player_dead_0(pl)
  check_cargo_dead(pl)
end

myob = objects:add(  1, OBJ_DOORV,  1070, 1957 )
myob = objects:add(  2, OBJ_DOORH,   734, 1525 )
myob = objects:add(  3, OBJ_DOORH2,  799, 1525 )
tuer_1 = objects:add(  4, OBJ_DOORH,  2577,  490 )
--tuer_2 = objects:add(  5, OBJ_DOORH,  2582,  578 )
tuer_2 = objects:add(  5, OBJ_DOORH,  2580,  535 )

schalter_1 = objects:add(  6, OBJ_SWITCHR, 2526,  470 )
letzter_zustand_1 = schalter_1:get_dispframe()
--schalter_2 = objects:add(  7, OBJ_SWITCHR, 2578,  552 )
schalter_2 = objects:add(  7, OBJ_SWITCHR, 2589,  502 )
letzter_zustand_2 = schalter_2:get_dispframe()

myob = objects:add(  8, OBJ_PILE,  686, 1777 )
myob = objects:add(  9, OBJ_PILE,  844, 1775 )
myob = objects:add( 10, OBJ_PILE,  302, 1198 )
myob = objects:add( 11, OBJ_PILE,  299,  529 )
myob = objects:add( 12, OBJ_PILE, 2650,  433 )
myob = objects:add( 13, OBJ_PILE, 2590,  958 )

myob = objects:add( 14, OBJ_BUILDING4,  472,  741 )
myob = objects:add( 15, OBJ_BUILDING4, 2428,  931 )

myob = objects:add_special(  0, SPOBJ_GWALL_L,  534,  427, 35 )
myob = objects:add_special(  1, SPOBJ_GWALL_L,  535,  675, 35 )
myob = objects:add_special(  2, SPOBJ_GWALL_D, 1331,   39, 35 )

myen = enemies:add(  1, E_SHIP_BLUE1,  161, 1804, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  167, 1618, 1, 0 )
myen.wp:add(  161, 1804, 1, 0 )
myen = enemies:add(  2, E_SHIP_BLUE1,  114, 1469, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  167, 1618, 1, 0 )
myen.wp:add(  114, 1469, 1, 0 )
myen = enemies:add(  3, E_SHIP_BLUE1,  114, 1469, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  203, 1331, 1, 0 )
myen.wp:add(  114, 1469, 1, 0 )
myen = enemies:add(  4, E_SHIP_BLUE1,  206, 1203, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  107, 1200, 0.5, 0 )
myen.wp:add(  206, 1203, 0.5, 0 )
myen = enemies:add( 35, E_SHIP_BLUE1,  127, 1040, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  293, 1046, 1, 0 )
myen.wp:add(  289, 1128, 0.5, 0 )
myen.wp:add(  127, 1040, 1, 0 )
myen = enemies:add(  5, E_SHIP_BLUE1,  161,  798, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  146,  916, 1, 0 )
myen.wp:add(  161,  798, 1, 0 )
myen.wp:add(  223,  698, 1, 0 )
myen.wp:add(  161,  798, 1, 0 )
myen = enemies:add(  6, E_SHIP_BLUE1,  202,  245, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  142,  270, 1, 0 )
myen.wp:add(  222,  207, 1, 0 )
myen = enemies:add(  7, E_SHIP_BLUE1,  430,   63, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  226,   59, 2, 0 )
myen.wp:add(  430,   63, 2, 0 )
myen = enemies:add(  8, E_SHIP_BLUE1,  659,  143, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  680,   46, 1, 0 )
myen.wp:add(  659,  143, 1, 0 )
myen = enemies:add(  9, E_SHIP_BLUE1,  920,  226, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add(  836,  142, 1, 0 )
myen.wp:add(  920,  226, 1, 0 )
myen.wp:add( 1079,  226, 1, 0 )
myen.wp:add( 1042,   73, 1, 0 )
myen.wp:add( 1079,  226, 1, 0 )
myen.wp:add(  920,  226, 1, 0 )
myen = enemies:add( 10, E_SHIP_BLUE1, 1355,   67, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add( 1174,   71, 1, 0 )
myen.wp:add( 1355,   67, 1, 0 )
myen.wp:add( 1285,  185, 1, 0 )
myen.wp:add( 1355,   67, 1, 0 )
myen = enemies:add( 11, E_SHIP_BLUE1, 2571,  264, 0, 80, 800, 2, 1, 0 )
myen:set_maxhit( 13 )
myen.wp:add( 2227,  246, 3, 0 )
myen.wp:add( 2571,  271, 3, 0 )
myen.wp:add( 2607,  378, 1, 0 )
myen.wp:add( 2571,  271, 1, 0 )
myen = enemies:add( 12, E_SHIP_BIGRED,  431,  427, 0, 0, 0, 0, 0, 0 )
myen.wp:add(  129,  416, 2.5, 0 )
myen.wp:add(  431,  427, 2.5, 0 )
myen.wp:add(  209,  497, 2, 0 )
myen.wp:add(  175,  541, 0.5, 0 )
myen.wp:add(  223,  698, 1.3, 0 )
myen.wp:add(  431,  701, 1.3, 0 )
myen.wp:add(  432,  556, 1.3, 0 )
myen.wp:add(  431,  427, 1.3, 0 )
myen = enemies:add( 13, E_SHIP_BIGRED, 1603,   70, 0, 0, 0, 0, 0, 0 )
myen.wp:add( 1590,  210, 1, 0 )
myen.wp:add( 1603,   70, 1, 0 )
myen.wp:add( 1772,   64, 1, 0 )
myen.wp:add( 1971,   63, 1, 0 )
myen.wp:add( 1957,  225, 1, 0 )
myen.wp:add( 1971,   63, 1, 0 )
myen.wp:add( 1772,   64, 1, 0 )
myen.wp:add( 1603,   70, 1, 0 )

myen = enemies:add( 14, E_TOWER_SINGLE,  130, 1834, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 15, E_TOWER_SINGLE,  246, 1779, 0, D_LEFT,  40, 800, 2, 1 )
myen = enemies:add( 16, E_TOWER_SINGLE,  222, 1579, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 17, E_TOWER_THREE,   224, 1459, 0,         220, 800, 2, 2, 0 )
myen = enemies:add( 18, E_TOWER_SINGLE,   82, 1320, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 19, E_TOWER_SINGLE,  287, 1240, 0, D_LEFT,  40, 800, 2, 1 )
myen = enemies:add( 20, E_TOWER_SINGLE,  237,  907, 0, D_LEFT,  40, 800, 2, 1 )
myen = enemies:add( 21, E_TOWER_SINGLE,  120,  849, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 22, E_TOWER_SINGLE,  940,  186, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 23, E_TOWER_SINGLE, 1199,  139, 0, D_UP,    40, 800, 2, 1 )
myen = enemies:add( 24, E_TOWER_SINGLE, 1503,  186, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 25, E_TOWER_SINGLE, 2192,  179, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 26, E_TOWER_SINGLE, 2321,   37, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 27, E_TOWER_SINGLE, 2318,  229, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 28, E_TOWER_SINGLE, 2372,  294, 0, D_UP,    40, 800, 2, 1 )
myen = enemies:add( 29, E_TOWER_SINGLE, 2514,  232, 0, D_DOWN,  40, 800, 2, 1 )
myen = enemies:add( 30, E_TOWER_THREE,  2574,  101, 0,         220, 800, 2, 2, 0 )
myen = enemies:add( 31, E_TOWER_SINGLE, 2631,  178, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 32, E_TOWER_SINGLE, 2642,  718, 0, D_LEFT,  40, 800, 2, 1 )
myen = enemies:add( 33, E_TOWER_SINGLE, 2566,  735, 0, D_RIGHT, 40, 800, 2, 1 )
myen = enemies:add( 34, E_TOWER_THREE,  2635,  976, 0,         220, 800, 2, 2, 0 )

if (LANGUAGE == LANG_DE) then
  action1 = "[f:impact10][c:white]MR. RELASH:[br][f:impact10][c:orange]HEY, DANKE FUER DIE RETTUNG! BRING MICH JETZT NACH HAUSE!"
  action2 = "[f:impact14][c:white]HEIMATBASIS[br][f:impact10][c:orange]DANKE, RELASH IST GESUND UND MUNTER!"
elseif (LANGUAGE == LANG_EN) then
  action1 = "[f:impact10][c:white]MR. RELASH:[br][f:impact10][c:orange]HEY, THANKS FOR SAVING ME, GUY! NOW BRING ME HOME!"
  action2 = "[f:impact14][c:white]HOMEBASE[br][f:impact10][c:orange]RECEIVED MR. RELASH!"
elseif (LANGUAGE == LANG_CR) then
  action1 = "[f:impact10][c:white]MR. RELASH:[br][f:impact10][c:orange]VDAKA ZA ZACHRANU CHLAPCE! TERAZ MA ODVEZ DOMOV!"
  action2 = "[f:impact14][c:white]ZAKLADNA[br][f:impact10][c:orange]PRIJATIE MR. RELASH!"
end

function hook_player_takes_cargo_0(pl, ba)
  if     pl:get_land_base() == 1 then
    local waffenschacht   = player[1]:get_weapon_slot(1)
    waffenschacht.type    = W_DOUBLE
    waffenschacht.active  = 1
    if player[1]:get_weapon_slot(1).bullets > 0 then
      waffenschacht.bullets = player[1]:get_weapon_slot(1).bullets + 100
    else
      waffenschacht.bullets = 100
    end
    waffenschacht.reload  = -1
    player[1]:set_weapon_slot(1, waffenschacht)
    player[1]:set_active_weapon( 1 )
    pl:set_weight( pl:get_weight() - 1 )
  elseif pl:get_land_base() == 2 then
    local waffenschacht   = pl:get_weapon_slot( 2 )
    waffenschacht.type    = W_BOMB
    waffenschacht.active  = 1
    if player[1]:get_weapon_slot(2).bullets > 0 then
      waffenschacht.bullets = player[1]:get_weapon_slot(2).bullets + 10
    else
      waffenschacht.bullets = 10
    end
    waffenschacht.reload  = 60
    pl:set_weapon_slot( 2, waffenschacht )
    pl:set_active_weapon( 2 )
    pl:set_weight( pl:get_weight() - 1 )
  elseif pl:get_land_base() == 3 then
    local waffenschacht   = pl:get_weapon_slot( 2 )
    waffenschacht.type    = W_BOMB
    waffenschacht.active  = 1
    if player[1]:get_weapon_slot(2).bullets > 0 then
      waffenschacht.bullets = player[1]:get_weapon_slot(2).bullets + 20
    else
      waffenschacht.bullets = 20
    end
    waffenschacht.reload  = 60
    pl:set_weapon_slot( 2, waffenschacht )
    pl:set_active_weapon( 2 )
    pl:set_weight( pl:get_weight() - 1 )
  elseif pl:get_land_base() == 4 then
    local waffenschacht   = player[1]:get_weapon_slot(1)
    waffenschacht.type    = W_DOUBLE
    waffenschacht.active  = 1
    if player[1]:get_weapon_slot(1).bullets > 0 then
      waffenschacht.bullets = player[1]:get_weapon_slot(1).bullets + 100
    else
      waffenschacht.bullets = 100
    end
    waffenschacht.reload  = -1
    player[1]:set_weapon_slot(1, waffenschacht)
    player[1]:set_active_weapon( 1 )
    pl:set_weight( pl:get_weight() - 1 )
  elseif pl:get_land_base() == 5 then
    pl:set_fuel( 99 )
    pl:set_weight( pl:get_weight() - 1 )
  elseif pl:get_land_base() == 6 then
    local frapelaosd = playmap[1].osd:get_osdbit(1000)
    frapelaosd:draw_typewriter_text( action1, 5, 5, 0 )
  end
end

function gf_level_5()
  if schalter_1:get_dispframe() ~= letzter_zustand_1 then
    if schalter_1:get_dispframe() == 0 then
      tuer_1:set_maxframe(3)
      tuer_1:set_startframe(1)
      tuer_1:set_dispframe(1)
    else
      tuer_1:set_maxframe(0)
      tuer_1:set_startframe(0)
      tuer_1:set_dispframe(0)
    end
    letzter_zustand_1 = schalter_1:get_dispframe()
  end
  if schalter_2:get_dispframe() ~= letzter_zustand_2 then
    if schalter_2:get_dispframe() == 0 then
      tuer_1:set_maxframe(0)
      tuer_1:set_startframe(0)
      tuer_1:set_dispframe(0)
      tuer_2:set_maxframe(3)
      tuer_2:set_startframe(1)
      tuer_2:set_dispframe(1)
    else
      tuer_1:set_maxframe(3)
      tuer_1:set_startframe(1)
      tuer_1:set_dispframe(1)
      tuer_2:set_maxframe(0)
      tuer_2:set_startframe(0)
      tuer_2:set_dispframe(0)
    end
    letzter_zustand_2 = schalter_2:get_dispframe()
  end
end   -- gf_level_5()
