-- Mars Mission II
-- Initscript


if (VERSION >= 0.9) then
  dofile("./levels/compat.lua")
end


USER_OBJECT00 = images:load("./bitmap/ship_pe.bmp")
USER_OBJECT01 = images:load("./bitmap/ship_bc.tga")
USER_OBJECT02 = images:load("./bitmap/ship_ti.tga")
USER_OBJECT03 = images:load("./bitmap/ship_sc.tga")
USER_OBJECT04 = images:load("./bitmap/hut.bmp")

if LANGUAGE == LANG_DE then
hassler_string = "[w:180][c:white]Mr. Hassler[c:yellow]: ''Hoppla, ich habe meinen schoenen Hut vergessen![w:15] Aber... ich habe schon meinen Pyjama an.[w:15] Bitte fliegen Sie noch einmal alleine zurueck und holen Sie das gute Stueck.[w:15] Ich bleibe derweil hier in [c:white]Zidia City[c:yellow] und programmiere einen dritten Tower-Level.''"
else
hassler_string = "[w:180][c:white]Mr. Hassler[c:yellow]: ''Oops, I forgot my nice hat![w:15] But... I already put on my pyjamas.[w:15] Please return again alone and take the hat here.[w:15] I'd rather stay here in [c:white]Zidia City[c:yellow] and program a third Tower Mission.''"
end

mybase = bases:add(  0, PLAYER_BASE, 2645, 1594 )

myob = objects:add(  0, OBJ_BUILDING4_2, 2802, 1479 )

mybase = bases:add(  1, ENEMY_S_BASE, 2886, 1499 )

myob = objects:add(  1, USER_OBJECT00, 2691, 1575 )

myob = objects:add(  2, USER_OBJECT01, 2648, 1576 )

myob = objects:add(  3, USER_OBJECT03, 2887, 1483 )

myob = objects:add(  4, USER_OBJECT02, 2904, 1481 )

myob = objects:add(  5, OBJ_BUILDING2, 2533, 1543 )

myob = objects:add(  6, OBJ_BUILDING4, 2570, 1556 )

myob = objects:add(  7, OBJ_BUILDING3, 2725, 1568 )

myob = objects:add(  8, OBJ_BUILDING3, 2757, 1568 )

myob = objects:add(  9, OBJ_PILE, 2716, 1585 )

myob = objects:add( 10, OBJ_PILE, 2797, 1485 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  1, E_TOWER_THREE, 2988, 1497,         0,            5,        100,                     2,             3,           0 )

-- heimat-teleporter
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
heimatele = objects:add_special(  0, SPOBJ_TELEPORT1, 3040, 1553,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  2, E_TOWER_SINGLE, 4314, 1310,        0,   D_RIGHT,            17,        500,                     4,             2 )

-- teschtgebiet
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  1, SPOBJ_TELEPORT1, 1025,  701,             0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  3, E_TOWER_SINGLE, 1118,  667,        0,   D_DOWN,            20,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  4, E_TOWER_SINGLE, 1129,  663,        0,   D_DOWN,            30,        500,                     3,             1 )

-- stark und langsam
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  5, E_TOWER_SINGLE, 1141,  647,        0,   D_DOWN,            50,        500,                     5,             3 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  6, E_TOWER_SINGLE, 1052,  579,        0,     D_UP,            40,        500,                     2,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  7, E_TOWER_SINGLE, 1082,  584,        0,     D_UP,            40,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  8, E_TOWER_SINGLE, 1106,  580,        0,     D_UP,            40,        500,                     2,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  9, E_TOWER_SINGLE, 1132,  577,        0,     D_UP,            40,        500,                     1,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 10, E_TOWER_SINGLE, 1066,  565,        0,   D_DOWN,            60,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 11, E_TOWER_SINGLE, 1093,  567,        0,   D_DOWN,            40,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 12, E_TOWER_SINGLE, 1118,  567,        0,   D_DOWN,            60,        500,                     3,             1 )

-- schnell
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 13, E_TOWER_SINGLE, 1154,  570,        0,   D_DOWN,            20,        500,                     4,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 14, E_TOWER_THREE, 1274,  629,         0,            40,        500,                     3,             1,           0 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 15, E_TOWER_THREE, 1343,  681,         0,            60,        500,                     2,             1,           0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 16, E_SHIP_BLUE1, 1082,  700,         0,            30,        600,                     4,             2,           0 )
myen.wp:add( 1082,  700, 1.0, 0 )
myen.wp:add( 1161,  674, 2.0, 0 )
myen.wp:add( 1178,  594, 1.0, 0 )
myen.wp:add( 1161,  673, 3.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 17, E_SHIP_BLUE2, 1206,  368,         0,            25,        600,                     4,             2,           0 )
myen.wp:add( 1206,  368, 3.0, 0 )
myen.wp:add( 1285,  429, 2.0, 0 )
myen.wp:add( 1236,  463, 1.5, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 18, E_SHIP_BLUE1, 1452,  400,         0,            30,        600,                     3,             2,           0 )
myen.wp:add( 1452,  400, 1.0, 0 )
myen.wp:add( 1400,  642, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 19, E_SHIP_BLUE1, 1523,  440,         0,            80,        800,                     3,             3,           0 )
myen.wp:add( 1523,  440, 2.0, 0 )
myen.wp:add( 1492,  544, 2.0, 0 )
myen.wp:add( 1607,  594, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 20, E_SHIP_BLUE1, 1591,  720,         0,           30,        150,                     3,             2,           0 )
myen.wp:add( 1591,  720, 3.0, 0 )
myen.wp:add( 1506,  654, 1.0, 0 )
myen.wp:add( 1447,  694, 2.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 21, E_SHIP_BLUE2, 1414,  735,         0,            10,        500,                     6,             3,           0 )
myen.wp:add( 1414,  735, 0.1, 20 )
myen.wp:add( 1414,  705, 0.1, 20 )

-- SPOBJ_EXTRA, Parameter:                            extrastaerke
myob = objects:add_special(  2, SPOBJ_EXTRA, 1456,  792,          15 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 22, E_TOWER_SINGLE, 1484,  790,        0,   D_LEFT,            30,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 23, E_TOWER_SINGLE, 1428,  796,        0,   D_RIGHT,            30,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 24, E_TOWER_SINGLE, 1677,  606,        0,   D_LEFT,            50,        800,                     3,             1 )

-- long range for this and two more
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 25, E_TOWER_SINGLE, 1680,  533,        0,   D_LEFT,            60,        800,                     3,             1 )
myen.wp:add( 1680,  533, 1.0, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 26, E_TOWER_SINGLE, 1678,  660,        0,   D_LEFT,            60,        800,                     3,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 27, E_TOWER_THREE, 1143,  381,         0,            40,        800,                     6,             3,           0 )

-- schnell
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 28, E_TOWER_SINGLE, 1176,  385,        0,     D_UP,            10,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 29, E_TOWER_SINGLE, 1142,  347,        0,   D_RIGHT,            40,        500,                     2,             1 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 30, E_TOWER_FLAK,  865,  388,        0,        60,            85,        800,                     3,             3 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 31, E_TOWER_FLAK,  884,  375,        0,        50,            90,        800,                     4,             3 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 32, E_TOWER_THREE,  986,  296,         0,            60,        500,                     2,             1,           0 )

-- sehr schnell und stark
-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 33, E_SHIP_BLUE1,  867,  153,         0,            11,        400,                     4,             1,           0 )
myen.wp:add(  867,  153, 2.0, 0 )
myen.wp:add(  918,  261, 4.0, 0 )
myen.wp:add(  944,  158, 2.0, 0 )
myen.wp:add(  965,  256, 4.0, 0 )
myen.wp:add(  985,  157, 3.0, 0 )
myen.wp:add(  993,  256, 2.0, 0 )
myen.wp:add( 1018,  156, 3.0, 0 )
myen.wp:add( 1025,  258, 4.0, 0 )
myen.wp:add( 1050,  155, 2.0, 0 )

-- sehr guter gegner
-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 34, E_SHIP_BLUE2,  364,  160,         0,            20,        500,                     5,             3,           0 )
myen.wp:add(  364,  160, 2.0, 0 )
myen.wp:add(  461,  273, 2.5, 0 )
myen.wp:add(  366,  399, 2.0, 0 )
myen.wp:add(  498,  460, 1.5, 0 )
myen.wp:add(  547,  358, 2.5, 0 )
myen.wp:add(  393,  297, 1.5, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 35, E_SHIP_BLUE1,  623,  377,         0,            23,        600,                     2,             2,           0 )
myen.wp:add(  623,  377, 1.0, 0 )
myen.wp:add(  648,  465, 1.0, 0 )
myen.wp:add(  744,  423, 1.0, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 36, E_TOWER_SINGLE,  604,  261,        0,   D_DOWN,            25,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 37, E_TOWER_SINGLE,  589,  242,        0,   D_LEFT,            25,        500,                     3,             1 )

mybase = bases:add(  2, ENEMY_S_BASE,  309,  489 )
myman = objects:add(100, OBJ_MAN1, 10, 10)
myman:set_invisible(1)
    
mybase:set_cargo_type(CARGO_OBJECT)
mybase:set_cargo_object(myman)
mybase:set_cargo_weight(5)
mybase:set_cargo_name("Mr. Hassler")


-- jetzt mal ein sinnloses objekt, dass so sinnlos ist, dass man es nicht sehen darf
myob = objects:add( 11, OBJ_MAN1,    7,    8 )
myob:set_invisible(1)

myob = objects:add( 12, OBJ_BUILDING3,  266,  462 )

myob = objects:add( 13, OBJ_BUILDING1,  225,  469 )

myob = objects:add( 14, OBJ_BUILDING1,  187,  469 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 38, E_TOWER_SINGLE,  408,  481,        0,     D_UP,            60,        500,                     2,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 39, E_TOWER_THREE,  381,  488,         0,            60,        400,                     4,             1,           0 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 40, E_TOWER_THREE,  364,  488,         0,            60,        400,                     4,             1,           0 )

-- E_SHIP_BIGRED, Parameter:                       signatur, [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt]
myen = enemies:add( 41, E_SHIP_BIGRED,  258,  403,         0,           0,           0,           0,           0,           0 )
myen.wp:add(  332,  379, 1.0, 0 )
myen.wp:add(  325,  426, 1.0, 0 )

-- hidden teleporter
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  3, SPOBJ_TELEPORT1,  316,  465,             4 )
myob:set_invisible(1)

-- hinterhalt zu sich selbst
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  4, SPOBJ_TELEPORT1, 4330, 1356,             4 )

-- ausgang
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
ausgang = objects:add_special(  5, SPOBJ_TELEPORT1, 3963, 1375,             0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 42, E_SHIP_BLUE2, 3940, 1210,         0,            40,        200,                     2,             2,           0 )
myen.wp:add( 3940, 1210, 1.0, 0 )
myen.wp:add( 4045, 1249, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 43, E_SHIP_BLUE2, 3983, 1120,         0,            40,        200,                     2,             2,           0 )
myen.wp:add( 3983, 1120, 1.0, 0 )
myen.wp:add( 4076, 1060, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 44, E_SHIP_BLUE1, 4236, 1071,         0,            30,        300,                     3,             2,           0 )
myen.wp:add( 4236, 1071, 1.0, 0 )
myen.wp:add( 4312, 1102, 1.0, 0 )
myen.wp:add( 4267, 1131, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 45, E_SHIP_BLUE1, 4233, 1202,         0,            30,        300,                     3,             2,           0 )
myen.wp:add( 4233, 1202, 1.0, 0 )
myen.wp:add( 4318, 1184, 1.0, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 46, E_TOWER_SINGLE, 4138, 1395,        0,     D_UP,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 47, E_TOWER_SINGLE, 4167, 1394,        0,     D_UP,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 48, E_TOWER_SINGLE, 4197, 1398,        0,     D_UP,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 49, E_TOWER_SINGLE, 4126, 1155,        0,     D_UP,            20,        300,                     3,             1 )

-- schnell und 47 auch
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 50, E_TOWER_SINGLE, 4116, 1153,        0,     D_UP,            20,        300,                     3,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 51, E_TOWER_THREE, 4191, 1100,         0,            20,        500,                     3,             1,           0 )




















-- Jetzt zum wichtigen Teil.





goodbase = bases:add(  3, ENEMY_S_BASE, 4029, 1306 )
myman = objects:add(100, OBJ_MAN1, 0, 0)
myman:set_invisible(1)
    
goodbase:set_cargo_type(CARGO_OBJECT)
goodbase:set_cargo_object(myman)
goodbase:set_cargo_weight(5)
goodbase:set_cargo_name("Mr. Hassler")

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 52, E_TOWER_SINGLE, 4365, 1281,        0,   D_LEFT,             17,        500,                     4,             2 )

myob = objects:add_special(  6, SPOBJ_BUMPU, 1041,  804 )

myob = objects:add_special(  7, SPOBJ_BUMPU,  962,  804 )






-- globale Frachtgewicht-Variable nullsetzen
frachtgewicht = 0
holedenheut = 0

-- Mission schlaegt fehl, wenn Spieler mit eingeladener Fracht zerstoert wird
function hook_player_dead_0( pl )
  if (pl:get_weight() > 0) then
    pl:set_mission_status(-1)
  end
end

-- Feststellen, ob der Hut geholt werden muss, oder ob alles angekommen ist

function hook_player_returns_cargo_0( pl )
  frachtgewicht = frachtgewicht + pl:get_weight()
  if (pl:get_weight() == 5) then
    hut = objects:add(99, USER_OBJECT04, 1, 20)
    hut:set_invisible(1)
    goodbase:set_cargo_type(CARGO_OBJECT)
    goodbase:set_cargo_object(hut)
    goodbase:set_cargo_weight(1)
    goodbase:set_cargo_name("Mr. Hasslers Hut")

    hutosd = playmap[1].osd:add(1, 195,  87, 250, 100, OSDBIT_SCREEN)

    hutosd:draw_typewriter_text(hassler_string, 10, 3, 1)
    holedenhut = 1
  end
  if (frachtgewicht == 6) then
    local myosd = playmap[1].osd:get_osdbit(1000)
    myosd:clear()
    pl:set_mission_status(1)
  end
end

if(holedenhut == 1) then
  if(player[1]:get_land() == 0) then
    hutosd:set_active(0)
  end
end
