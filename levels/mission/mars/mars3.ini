-- Mars Mission III
-- Initscript


if (VERSION >= 0.9) then
  dofile("./levels/compat.lua")
end

player[1]:set_lifes(2)

-- auge
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  0, SPOBJ_TELEPORT1,  804, 2601,             1 )


mybase = bases:add(  0, PLAYER_BASE,  368, 2651 )

-- maul
-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  1, SPOBJ_TELEPORT1,  682, 2801,             0 )

xyz = images:load("./bitmap/ammo.bmp")
ammo = objects:add(100, xyz, 0, 0)
ammo:set_invisible(1)

if LANGUAGE == LANG_DE then
  word_grenades = "Panzergranaten"
  ship_lost = "[w:60]Sie haben ein Schiff vergeigt.[w:30] [c:orange]Wenn Sie das wieder machen, ist Ihre Mission gescheitert!"
  you_brought_four = "[w:180]Super! Das war Ihre vierte Lieferung.[w:30] Sie koennen jetzt entweder weiterspielen - [c:green]oder zum Beenden in diesen Teleporter fliegen!"
else
  word_grenades = "Tank Ammunition"
  ship_lost = "[w:60]You lost a ship.[w:30] [c:orange]If you do that again, you will fail!"
  you_brought_four = "[w:180]Super! That was your fourth delivery. You can either go on - [c:green]or finish the mission by using this teleporter!"
end  

basis1 = bases:add(  1, CARGO_BASE,  556, 2265 )
basis1:set_cargo_type(CARGO_OBJECT)
basis1:set_cargo_object(ammo)
basis1:set_cargo_weight(20)
basis1:set_cargo_name(word_grenades)
basis2 = bases:add(  2, CARGO_BASE,  793, 3031 )
basis2:set_cargo_type(CARGO_OBJECT)
basis2:set_cargo_object(ammo)
basis2:set_cargo_weight(20)
basis2:set_cargo_name(word_grenades)
basis3 = bases:add(  3, CARGO_BASE,  320, 3084 )
basis3:set_cargo_type(CARGO_OBJECT)
basis3:set_cargo_object(ammo)
basis3:set_cargo_weight(20)
basis3:set_cargo_name(word_grenades)
basis4 = bases:add(  4, CARGO_BASE,  761, 2651 )
basis4:set_cargo_type(CARGO_OBJECT)
basis4:set_cargo_object(ammo)
basis4:set_cargo_weight(20)
basis4:set_cargo_name(word_grenades)
basis5 = bases:add(  5, CARGO_BASE,  231, 2459 )
basis5:set_cargo_type(CARGO_OBJECT)
basis5:set_cargo_object(ammo)
basis5:set_cargo_weight(20)
basis5:set_cargo_name(word_grenades)

myob = objects:add(  0, OBJ_PILE,  467, 2642 )
myob = objects:add(  1, OBJ_PILE,  892, 2782 )
myob = objects:add(  2, OBJ_PILE,  438, 3074 )
myob = objects:add(  3, OBJ_PILE, 1201, 2342 )
myob = objects:add(  4, OBJ_BUILDING2,  713, 2801 )
myob = objects:add(  5, OBJ_BUILDING1, 1008, 2916 )
myob = objects:add(  6, OBJ_BUILDING1, 1094, 2927 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  1, E_TOWER_SINGLE,  480, 3040,        0,   D_LEFT,            30,        500,                     3,             1 )

-- E_SHIP_BIGRED, Parameter:                       signatur, [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt]
myen = enemies:add(  2, E_SHIP_BIGRED,  253, 2155,         0,           0,           0,           0,           0,           0 )
myen.wp:add(  268, 2155, 0.10, 20 )
myen.wp:add(  228, 2174, 0.10, 20 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  3, E_SHIP_BLUE1,  271, 2386,         0,            45,        500,                     3,             2,           0 )
myen.wp:add(  271, 2386, 1.0, 0 )
myen.wp:add(  543, 2476, 2.0, 0 )
myen.wp:add(  420, 2167, 1.0, 0 )
myen.wp:add(  423, 2321, 2.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  4, E_SHIP_BLUE1,  587, 2363,         0,            80,        700,                     5,             4,           0 )
myen.wp:add(  587, 2363, 1.0, 0 )
myen.wp:add(  682, 2418, 1.5, 0 )
myen.wp:add(  817, 2279, 1.5, 0 )
myen.wp:add(  605, 2171, 2.0, 0 )
myen.wp:add(  746, 2392, 2.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  5, E_SHIP_BLUE1,  863, 2237,         0,            15,        300,                     3,             2,           0 )
myen.wp:add(  863, 2237, 3.0, 0 )
myen.wp:add(  942, 2405, 1.5, 0 )
myen.wp:add(  860, 2455, 2.0, 0 )
myen.wp:add(  917, 2517, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  6, E_SHIP_BLUE2,  929, 2537,         0,            30,        600,                     3,             2,           0 )
myen.wp:add(  929, 2537, 1.0, 0 )
myen.wp:add( 1121, 2463, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  7, E_SHIP_BLUE2, 1182, 2538,         0,            35,        700,                     3,             2,           0 )
myen.wp:add( 1182, 2538, 1.0, 0 )
myen.wp:add( 1009, 2593, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  8, E_SHIP_BLUE2, 1034, 2664,         0,            40,        800,                     3,             2,           0 )
myen.wp:add( 1034, 2664, 1.0, 0 )
myen.wp:add( 1214, 2639, 1.0, 0 )
myen.wp:add( 1160, 2715, 1.0, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  9, E_TOWER_SINGLE,  972, 2642,        0,     D_UP,            20,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 10, E_TOWER_SINGLE,  929, 2607,        0,     D_UP,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 11, E_TOWER_SINGLE, 1006, 2679,        0,     D_UP,            40,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 12, E_TOWER_SINGLE, 1261, 2530,        0,   D_LEFT,            30,        600,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 13, E_TOWER_SINGLE, 1297, 2593,        0,   D_LEFT,            10,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 14, E_TOWER_SINGLE, 1297, 2631,        0,   D_LEFT,            45,        300,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 15, E_TOWER_SINGLE, 1298, 2683,        0,   D_LEFT,            20,        300,                     4,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 16, E_TOWER_THREE,  731, 2797,         0,            20,        200,                     3,             1,           0 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 17, E_TOWER_THREE,  754, 2797,         0,            20,        200,                     3,             1,           0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 18, E_TOWER_SINGLE,  845, 2704,        0,   D_DOWN,            60,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 19, E_TOWER_SINGLE,  822, 2701,        0,   D_DOWN,            45,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 20, E_TOWER_SINGLE,  948, 2735,        0,   D_DOWN,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 21, E_TOWER_SINGLE,  961, 2735,        0,   D_DOWN,            60,        500,                     5,             1 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 22, E_TOWER_FLAK,  773, 3022,        0,        90,            55,        500,                     2,             3 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 23, E_TOWER_FLAK,  869, 3026,        0,        80,            60,        500,                     3,             3 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 24, E_SHIP_BLUE1,  994, 2786,         0,            30,        700,                     4,             2,           0 )
myen.wp:add(  994, 2786, 1.5, 0 )
myen.wp:add( 1072, 2849, 1.5, 0 )
myen.wp:add(  813, 2915, 1.5, 0 )
myen.wp:add(  885, 2977, 1.5, 0 )

-- E_SHIP_BIGRED, Parameter:                       signatur, [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt]
myen = enemies:add( 25, E_SHIP_BIGRED,  623, 3010,         0,           0,           0,           0,           0,           0 )
myen.wp:add(  623, 3010, 0.5, 0 )
myen.wp:add(  666, 3086, 0.5, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 26, E_SHIP_BLUE2,  280, 2927,         0,            45,        800,                     2,             2,           0 )
myen.wp:add(  280, 2927, 0.5, 0 )
myen.wp:add(  406, 2932, 0.5, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 27, E_TOWER_SINGLE,  270, 3051,        0,   D_RIGHT,            20,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 28, E_TOWER_SINGLE,  272, 2990,        0,   D_RIGHT,            15,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 29, E_TOWER_SINGLE,  479, 3010,        0,   D_LEFT,            30,        500,                     2,             1 )

-- SPOBJ_EXTRA, Parameter:                            extrastaerke
myob = objects:add_special(  2, SPOBJ_EXTRA,  238, 2192,         100 )

-- SPOBJ_EXTRA, Parameter:                            extrastaerke
myob = objects:add_special(  3, SPOBJ_EXTRA, 1264, 2380,          20 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 30, E_SHIP_BLUE1,  488, 3085,         0,            47,        400,                     4,             2,           0 )
myen.wp:add(  488, 3085, 1.0, 0 )
myen.wp:add(  604, 3085, 1.0, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 31, E_TOWER_SINGLE,  480, 2561,        0,   D_LEFT,            20,        300,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 32, E_TOWER_SINGLE,  311, 2584,        0,   D_RIGHT,            20,        300,                     3,             1 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 33, E_TOWER_THREE,  626, 2452,         0,            40,        500,                     4,             3,           0 )







-- die beiden Variablen
frachtgewicht = 0
einsdarfkaputt = 0
schongewonnen = 0

-- Bei zwei verlorenen Schiffen ist die Mission aus
function hook_player_dead_0( pl )
  if(einsdarfkaputt == 1) then
    pl:set_mission_status(-1)
  else
kaputosd = playmap[1].osd:add(1, 195,  87, 250, 100, OSDBIT_SCREEN)
kaputosd:draw_typewriter_text(ship_lost, 10, 2, 1)
  einsdarfkaputt = 1
end
end

-- Ankommende Fracht zaehlen, Ausgang-Teleporter erstellen, Gewinn bei 100 Fracht
function hook_player_returns_cargo_0( pl )
  frachtgewicht = frachtgewicht + pl:get_weight()
  if (frachtgewicht == 80) then
    jawoll = playmap[1].osd:add(1, 195,  87, 250, 100, OSDBIT_SCREEN)
    jawoll:draw_typewriter_text(you_brought_four, 10, 2, 1)
    ausgang = objects:add_special( 50, SPOBJ_TELEPORT1,  368, 2551, 50 )
  end
  if (frachtgewicht == 100) then
    local myosd = playmap[1].osd:get_osdbit(1000)
    myosd:clear()
    pl:set_mission_status(1)
  end  
end

-- Alternativer Gewinn, wenn der Ausgang benutzt wird
function hook_player_with_spobject_0(pl, spob)
  if (spob == ausgang) then
    if (schongewonnen == 0) then
      local myosd = playmap[1].osd:get_osdbit(1000)
      myosd:clear()
      pl:set_mission_status(1)
      schongewonnen = 1
    end
  end
end