-- Mars Mission IV
-- Initscript

if (VERSION >= 0.9) then
  dofile("./levels/compat.lua")
end


ich_will_cheaten = 0
-- Diese Variable auf Null lassen, es sei denn, man will wirklich cheaten, dann 1.
-- Es erscheinen dann nur die Pulse-Kanonen, sonst keine weitern Gegner. Test-Option :),
-- die eigentlich raus sollte. Alternativ haette man einen Extra-Sting nehmen koennen.

USER_OBJECT00 = images:load("./bitmap/ship_pe.bmp")
USER_OBJECT01 = images:load("./bitmap/ship_sc.tga")
USER_OBJECT02 = images:load("./bitmap/ship_ti.tga")
USER_OBJECT03 = images:load("./bitmap/ship_ma.tga")

if LANGUAGE == LANG_DE then
you_got_the_single = "[w:10]Ein rebellischer Single Blaster! Damit koennen Sie wieder auf die ganz billige Weise schiessen."
you_got_all = "[w:10]Eiderdaus! Sie haben alle Pulse-Kanonen zerstoert.[w:30] Hey, gleich kommt [c:white]FUTURAMA[c:yellow], also hurtig zurueck nach [c:white]Dynidon Vale[c:yellow]."
else
you_got_the_single = "[w:10]A Single Blaster made by the rebels! Now you can shoot the cheap way again."
you_got_all = "[w:10]Wow! You've destroyed all the pulse cannons. Hey, tonight there's [c:white]FUTURAMA[c:yellow] on TV, so you gotta quickly fly back to [c:white]Dynidon Vale[c:yellow]."
end

mybase = bases:add(  0, PLAYER_BASE, 3938, 3082 )
myob = objects:add(  0, OBJ_BUILDING3, 3771, 3057 )
myob = objects:add(  1, OBJ_BUILDING3, 3803, 3057 )
myob = objects:add(  2, OBJ_BUILDING1, 3873, 3063 )
myob = objects:add(  3, OBJ_BUILDING2, 3838, 3030 )
myob = objects:add(  4, OBJ_PILE, 4017, 3073 )
myob = objects:add(  5, OBJ_PILE, 3722, 2878 )
myob = objects:add(  6, OBJ_BUILDING4, 4033, 3042 )
mybase = bases:add(  1, ENEMY_S_BASE, 3683, 2892 )
myob = objects:add(  7, OBJ_BUILDING3, 3739, 3057 )
myob = objects:add(  8, USER_OBJECT00, 3686, 2873 )
myob = objects:add(  9, USER_OBJECT01, 3701, 2876 )
myob = objects:add( 10, USER_OBJECT02, 3862, 3014 )
myob = objects:add( 11, USER_OBJECT03, 3985, 3063 )
myob = objects:add( 12, OBJ_BUILDING4_2, 3634, 2877 )
singlebase = bases:add(  2, ENEMY_S_BASE, 2803, 2943 )


-- E_TOWER_PULSE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 101, E_TOWER_PULSE, 3707, 3692,         0,            7,        550,                     4,             2,           0 )

-- E_TOWER_PULSE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 102, E_TOWER_PULSE, 2912, 3795,         0,            7,        800,                     4,             2,           0 )

-- E_TOWER_PULSE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 103, E_TOWER_PULSE, 3013, 3645,         0,            7,        700,                     4,             2,           0 )-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]




if ich_will_cheaten == 0 then

myen = enemies:add(  1, E_SHIP_BLUE1, 3830, 2790,         0,            79,        1,                     2,             1,           0 )
myen.wp:add( 3830, 2790, 0.8, 0 )
myen.wp:add( 3735, 2854, 1.2, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  2, E_SHIP_BLUE1, 3782, 2742,         0,            38,        500,                     3,             2,           0 )
myen.wp:add( 3782, 2742, 1.5, 0 )
myen.wp:add( 3649, 2802, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add(  3, E_SHIP_BLUE2, 3478, 2570,         0,            30,        500,                     4,             2,           0 )
myen.wp:add( 3478, 2570, 1.0, 0 )
myen.wp:add( 3440, 2644, 1.0, 0 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  4, E_TOWER_FLAK, 3583, 2790,        0,        30,            65,        500,                     3,             3 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  5, E_TOWER_SINGLE, 3597, 2790,        0,     D_UP,            30,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  6, E_TOWER_SINGLE, 3575, 2789,        0,     D_UP,            20,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  7, E_TOWER_SINGLE, 3488, 2709,        0,   D_RIGHT,            40,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  8, E_TOWER_SINGLE, 3493, 2737,        0,   D_RIGHT,            30,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add(  9, E_TOWER_SINGLE, 3490, 2765,        0,   D_RIGHT,            45,        500,                     4,             1 )

-- lange ausloeserradius
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 10, E_TOWER_SINGLE, 3758, 2646,        0,   D_LEFT,            30,        1000,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 11, E_TOWER_SINGLE, 3325, 2630,        0,   D_DOWN,            20,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 12, E_TOWER_SINGLE, 3398, 2638,        0,   D_DOWN,            40,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 13, E_TOWER_SINGLE, 3342, 2685,        0,     D_UP,            35,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 14, E_TOWER_SINGLE, 3370, 2685,        0,     D_UP,            45,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 15, E_TOWER_SINGLE, 3314, 2761,        0,     D_LEFT,            50,        500,                     5,             3 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 16, E_TOWER_THREE, 3307, 2840,         0,            60,        500,                     5,             2,           0 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 17, E_TOWER_THREE, 3269, 2914,         0,            50,        500,                     4,             1,           0 )

-- E_TOWER_THREE, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 18, E_TOWER_THREE, 3145, 3027,         0,            60,        500,                     3,             1,           0 )

-- schnell
-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 19, E_SHIP_BLUE1, 3025, 2636,         0,            30,        800,                     3,             2,           0 )
myen.wp:add( 3025, 2636, 3.0, 0 )
myen.wp:add( 3249, 2720, 2.0, 0 )
myen.wp:add( 3148, 2799, 3.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 20, E_SHIP_BLUE2, 2973, 2836,         0,            60,        800,                     2,             2,           0 )
myen.wp:add( 2973, 2836, 1.0, 0 )
myen.wp:add( 2948, 2907, 1.5, 0 )
myen.wp:add( 3109, 2941, 1.0, 0 )
myen.wp:add( 3158, 2903, 2.0, 0 )

-- E_SHIP_BIGRED, Parameter:                       signatur, [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt], [unbenutzt]
myen = enemies:add( 21, E_SHIP_BIGRED, 2837, 2898,         0,           0,           0,           0,           0,           0 )
myen.wp:add( 2837, 2898, 1.5, 0 )
myen.wp:add( 2767, 2828, 0.5, 0 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 22, E_TOWER_SINGLE, 2760, 2888,        0,   D_RIGHT,            50,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 23, E_TOWER_SINGLE, 2766, 2907,        0,   D_RIGHT,            80,        500,                     4,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 24, E_TOWER_SINGLE, 2766, 2927,        0,   D_RIGHT,            40,        500,                     5,             3 )

-- E_TOWER_FLAK, Parameter:                       signatur, expl.zeit, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 25, E_TOWER_FLAK, 3082, 3218,        0,        20,            70,        500,                     4,             3 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 26, E_TOWER_SINGLE, 3062, 3199,        0,   D_UP,            60,        500,                     3,             1 )

-- E_TOWER_SINGLE, Parameter:                       signatur,  richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 27, E_TOWER_SINGLE, 3070, 3209,        0,   D_UP,            20,        500,                     1,             1 )

-- langer radius schnelle schuesse
-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 28, E_TOWER_SINGLE, 3215, 3127,        0,   D_LEFT,            20,       1000,                     3,             3 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 29, E_TOWER_SINGLE, 3232, 3447,        0,     D_UP,            20,        500,                     5,             3 )

-- E_TOWER_SINGLE, Parameter:                       signatur, richtung, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke
myen = enemies:add( 30, E_TOWER_SINGLE, 3355, 3552,        0,     D_UP,            30,        500,                     5,             3 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 31, E_SHIP_BLUE2, 3645, 3384,         0,            45,        800,                     2,             2,           0 )
myen.wp:add( 3645, 3384, 1.0, 0 )
myen.wp:add( 3518, 3520, 1.0, 0 )
myen.wp:add( 3686, 3474, 1.0, 0 )

-- E_SHIP_BLUE2, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 32, E_SHIP_BLUE2, 2779, 3399,         0,            35,        800,                     2,             2,           0 )
myen.wp:add( 2779, 3399, 1.0, 0 )
myen.wp:add( 2885, 3491, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 33, E_SHIP_BLUE1, 3268, 3236,         0,            6,        1,                     2,             2,           0 )
myen.wp:add( 3268, 3236, 2.0, 0 )
myen.wp:add( 3067, 3364, 2.0, 0 )
myen.wp:add( 3095, 3434, 3.0, 0 )
myen.wp:add( 3227, 3324, 3.0, 0 )
myen.wp:add( 3378, 3380, 1.0, 0 )
myen.wp:add( 3260, 3398, 2.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 34, E_SHIP_BLUE1, 3453, 3444,         0,            90,        500,                     5,             4,           0 )
myen.wp:add( 3453, 3444, 1.5, 0 )
myen.wp:add( 3415, 3510, 1.0, 0 )

-- E_SHIP_BLUE1, Parameter:                        signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
myen = enemies:add( 35, E_SHIP_BLUE1, 3016, 3444,         0,           120,        600,                     5,             4,           0 )
myen.wp:add( 3016, 3444, 2.0, 0 )
myen.wp:add( 3117, 3476, 1.5, 0 )
myen.wp:add( 3044, 3500, 3.0, 0 )
myen.wp:add( 3121, 3513, 1.0, 0 )


myob = objects:add_special(  0, SPOBJ_TELEPORT1, 2763, 3754, 0 )
myob = objects:add_special(  1, SPOBJ_TELEPORT1, 3846, 3538, 1 )






end



















PICKUP_SINGLE = images:load("./bitmap/w_single.bmp")
PICKUP_SINGLE = objects:add(100, PICKUP_SINGLE, 0, 0)



local n
local single = -1
for n = 0,5 do
  local tslot = player[1]:get_weapon_slot(n)
  if (tslot.type == W_SINGLE) then
    single = n
    singlebase:set_cargo_type(CARGO_OBJECT)
    singlebase:set_cargo_object(PICKUP_SINGLE)
    singlebase:set_cargo_weight(20)
  end
  player[1]:deactivate_weapon_slot(single)
end




function hook_player_takes_cargo_0(spieler)
  if player[1]:get_weight() == 20 then
    local s
    local single = -1
    for s = 0,5 do
      local tslot = player[1]:get_weapon_slot(s)
      if (tslot.type == W_SINGLE) then singleb = s end
      player[1]:activate_weapon_slot(singleb)
    end
    local thatosd = playmap[1].osd:get_osdbit(1000)
    thatosd:clear()
    thatosd:draw_typewriter_text(you_got_the_single, 10, 2, 1)
    player[1]:set_active_weapon(0)
  end
  player[1]:set_weight(0)
end

killed_pulses = 0
alleweg = 0

function hook_enemy_dead_0(whichguy)
  if whichguy:get_nr() == 101 then
    killed_pulses = killed_pulses + 1
  elseif whichguy:get_nr() == 102 then
    killed_pulses = killed_pulses + 1
  elseif whichguy:get_nr() == 103 then
    killed_pulses = killed_pulses + 1
  end
-- Ja, ich weiss, das haette man auch mit "whichguy:get_type()" loesen koennen,
-- aber ich finde das Script auf diese Weise dreimal so aesthaetisch.
  if killed_pulses == 3 then
    alleweg = 1
    local winnerosd = playmap[1].osd:get_osdbit(1000)
    winnerosd:clear()
    winnerosd:draw_typewriter_text(you_got_all, 10, 3, 1)
    killed_pulses = 4
  end
end

