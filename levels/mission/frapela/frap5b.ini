-- Frapela5b
-- INI file
-- created by GS-Map-Editor v0.6
-- und Frapela und Frapela sin Fru als Versorgerin
-- 29.11.2002

---------------------------------------------------------------------------------------------------
-- PLATZHALTER -- PLATZHALTER -- PLATZHALTER -- PLATZHALTER -- PLATZHALTER -- PLATZHALTER ---------
---------------------------------------------------------------------------------------------------


if (VERSION >= 0.9) then
  dofile("./levels/compat.lua")
end


hilfsvar = {}
local i
for i = 1, 20 do
  hilfsvar[i] = 0
end
hilfsvar1 = 0
verfolger = {}
verfolgerx = {}
verfolgery = {}
xalt = {}
yalt = {}
verfolgerwp = {}
Fracht = {}
leben = 0

---------------------------------------------------------------------------------------------------
-- OBJEKTE -- OBJEKTE -- OBJEKTE -- OBJEKTE -- OBJEKTE -- OBJEKTE --  OBJEKTE  --  OBJEKTE  -------
---------------------------------------------------------------------------------------------------

-- Basen
Heimatbasis = bases:add(  0, PLAYER_BASE,  558,  635 )
Fracht[1] = bases:add(  1, CARGO_BASE, 2290, 1114 )
Fracht[2] = bases:add(  2, CARGO_BASE,  842, 1161 )
Fracht[3] = bases:add(  3, CARGO_BASE, 1660, 1595 )
Fracht[4] = bases:add(  4, CARGO_BASE,  703, 2363 )
Fracht[5] = bases:add(  5, CARGO_BASE, 2122, 2364 )
local i
for i = 1, 5 do
  Fracht[i]:set_cargo_type(CARGO_NORMAL)
  Fracht[i]:set_cargo_weight(20)
end

-- Respawning Extras
dofile("./levels/libextra.sc")
add_respawning_extra(  986, 1136, 20,   60)

-- SPOBJ_TELEPORT1, Parameter:                            zielteleporter
myob = objects:add_special(  0, SPOBJ_TELEPORT1, 2364,  794,             1 )
myob = objects:add_special(  1, SPOBJ_TELEPORT1, 1013, 1174,             0 )
myob = objects:add_special(  2, SPOBJ_TELEPORT1, 1611, 1554,             3 )
myob = objects:add_special(  3, SPOBJ_TELEPORT1, 2257,  571,             2 )

-- Tür und Schalter
tuer1 = objects:add(  1, OBJ_DOORV2, 2145,  521 )
tuer2 = objects:add(  2, OBJ_DOORH2,  744,  843 )
tuer2:set_maxframe(0)   
tuer2:set_startframe(0) 
tuer2:set_dispframe(0)
schalter0 = objects:add(  0, OBJ_SWITCHR, 1579,  955 )
schalter  = objects:get_object(0)
letzter_zustand = schalter:get_dispframe()

---------------------------------------------------------------------------------------------------
-- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER -- GEGNER 
---------------------------------------------------------------------------------------------------

-- E_SHIP_BLUE1, Parameter:                               signatur, feuerfrequenz, akt.radius, schussgeschwindigkeit, schussstaerke, [unbenutzt]
verfolger[1] = enemies:add(  1, E_SHIP_BLUE1, 1013,  592,        0,            30,       1200,                     2,             1,           0 )
verfolger[1].wp:add( 1013,  592, 1.0)
verfolger[2] = enemies:add(  2, E_SHIP_BLUE1, 1013,  545,        0,            40,       1200,                     3,             1,           0 )
verfolger[2].wp:add( 1013,  545, 1.0)
verfolger[3] = enemies:add(  3, E_SHIP_BLUE1, 1013,  639,        0,            50,       1200,                     4,             1,           0 )
verfolger[3].wp:add( 1013,  639, 1.0)
verfolger[4] = enemies:add(  4, E_SHIP_BLUE1,  631, 1233,        0,            60,       1200,                     3,             1,           0 )
verfolger[4].wp:add(  631, 1233, 1.0)
verfolger[5] = enemies:add(  5, E_SHIP_BLUE1, 1343, 1233,        0,            70,       1200,                     2,             1,           0 )
verfolger[5].wp:add( 1343, 1233, 1.0)
verfolger[6] = enemies:add(  6, E_SHIP_BLUE1,  950, 1605,        0,            80,       1200,                     3,             1,           0 )
verfolger[6].wp:add(  950, 1605, 1.0)
verfolger[7] = enemies:add(  7, E_SHIP_BLUE1,  930, 2196,        0,            70,       1200,                     4,             1,           0 )
verfolger[7].wp:add(  930, 2196, 1.0)
verfolger[8] = enemies:add(  8, E_SHIP_BLUE1,  623, 1910,        0,            60,       1200,                     3,             1,           0 )
verfolger[8].wp:add(  623, 1910, 1.0)
verfolger[9] = enemies:add(  9, E_SHIP_BLUE1, 1288, 1906,        0,            50,       1200,                     2,             1,           0 )
verfolger[9].wp:add( 1288, 1906, 1.0)
verfolger[10] = enemies:add( 10,E_SHIP_BLUE1, 1299, 2220,        0,            40,       1200,                     3,             1,           0 )
verfolger[10].wp:add( 1299, 2220, 1.0)
verfolger[11] = enemies:add( 11,E_SHIP_BLUE1, 2138, 1874,        0,            30,       1200,                     4,             1,           0 )
verfolger[11].wp:add( 2138, 1874, 1.0)
verfolger[12] = enemies:add( 12,E_SHIP_BLUE1, 2140, 2214,        0,            40,       1200,                     3,             1,           0 )
verfolger[12].wp:add( 2140, 2214, 1.0)
verfolger[13] = enemies:add( 13,E_SHIP_BLUE1, 1723, 2224,        0,            50,       1200,                     2,             1,           0 )
verfolger[13].wp:add( 1723, 2224, 1.0)
verfolger[14] = enemies:add( 14,E_SHIP_BLUE1, 1646, 1816,        0,            60,       1200,                     3,             1,           0 )
verfolger[14].wp:add( 1646, 1816, 1.0)
verfolger[15] = enemies:add( 15,E_SHIP_BLUE1, 1219, 1554,        0,            70,       1200,                     4,             1,           0 )
verfolger[15].wp:add( 1219, 1554, 1.0)
verfolger[16] = enemies:add( 16,E_SHIP_BLUE1, 1635, 1236,        0,            80,       1200,                     3,             1,           0 )
verfolger[16].wp:add( 1635, 1236, 1.0)
verfolger[17] = enemies:add( 17,E_SHIP_BLUE1, 2097, 1541,        0,            70,       1200,                     2,             1,           0 )
verfolger[17].wp:add( 2097, 1541, 1.0)
verfolger[18] = enemies:add( 18,E_SHIP_BLUE1, 1825, 1047,        0,            60,       1200,                     3,             1,           0 )
verfolger[18].wp:add( 1825, 1047, 1.0)
verfolger[19] = enemies:add( 19,E_SHIP_BLUE1, 1479,  637,        0,            50,       1200,                     4,             1,           0 )
verfolger[19].wp:add( 1479,  637, 1.0)
verfolger[20] = enemies:add( 20,E_SHIP_BLUE1, 1874,  695,        0,            40,       1200,                     3,             1,           0 )
verfolger[20].wp:add( 1874,  695, 1.0)

---------------------------------------------------------------------------------------------------
-- FUNKTIONEN -- FUNKTIONEN -- FUNKTIONEN -- FUNKTIONEN -- FUNKTIONEN -- FUNKTIONEN -- FUNKTIONEN -
---------------------------------------------------------------------------------------------------

globals.score_per_second = 1

-- Frachtfunktionen einbinden
dofile("./levels/libcargo.sc")
init_cargo()
function hook_player_returns_cargo_0(pl)
  check_cargo_return(pl)
  if (__cargo_weight > 0) then
    local pakete = __cargo_weight / 20
    local paketosd = playmap[1].osd:get_osdbit(1000)
    if (LANGUAGE == LANG_DE) then
      if pakete == 4 then
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Saubere Arbeit " .. player[1]:get_name() .. "! Jetzt brauchst du nur noch [c:orange]".. pakete.."[c:yellow] Frachtpakete einzufliegen, also mach hin!", 30, 4, 1)
      elseif pakete == 3 then
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Klasse " .. player[1]:get_name() .. "! Jetzt nur noch [c:orange]".. pakete.."[c:yellow] !", 30, 4, 1)
      elseif pakete == 2 then
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Prima " .. player[1]:get_name() .. "! Besorge jetzt die beiden letzten Pakete, dann hast du es geschafft!", 30, 4, 1)
      else
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Spitze " .. player[1]:get_name() .. "! Beim letzten Frachtpaket wirst du ja wohl nicht noch verzappeln, oder?", 30, 4, 1)
      end
    else 
      paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Super " .. player[1]:get_name() .. "! Now you must only fetch [c:orange]".. pakete.."[c:yellow] parcels, go on!", 30, 4, 1)
    end 
  end
end

-- Schalter und Türen wieder in Ausgangsposition
function hook_player_dead_0(pl)
  check_cargo_dead(pl)
  tuer1:set_maxframe(3)   
  tuer1:set_startframe(1) 
  tuer1:set_dispframe(1) 
  tuer2:set_maxframe(0)   
  tuer2:set_startframe(0) 
  tuer2:set_dispframe(0)
  schalter:set_dispframe(0)
  letzter_zustand = schalter:get_dispframe()
end

-- tote Gegner zählen 
function hook_enemy_dead_0(en)
  leben = leben + 1
  if leben >= 20 then
    player[1]:set_homebase(0)
    local paketosd = playmap[1].osd:get_osdbit(1000)
    if (LANGUAGE == LANG_DE) then
      paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Spitze " .. player[1]:get_name() .. "! Auf der Heimatbasis sind die evakuierten Helfer wieder eingetroffen! Du kannst dein Schiff nun wieder entladen lassen!", 10, 4, 1)
    else 
      paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Fabulous " .. player[1]:get_name() .. "! The homebase is open now, go on!", 30, 4, 1)
    end
  end
end

function hook_player_land_0(pl, ba)
  if player[1]:get_land_base() <= 5 then
    if leben < 20 then
      player[1]:set_homebase(102)
      if (player[1]:get_land_base() == 0) and (player[1]:get_weight() == 20) then
        if hilfsvar1 == 0 then
          hilfsvar1 = 1
          if (LANGUAGE == LANG_DE) then
            local paketosd = playmap[1].osd:get_osdbit(1000)
            paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Hast wohl wieder nicht richtig aufgepasst " .. player[1]:get_name() .. ", wie! Erst die Gegner, DANN die Frachtpaket. Die Entladen-Trupps sind doch evakuiert worden. Jetzt sieh' zu, wie du aus dieser Nummer wieder rauskommst!", 10, 4, 1)
          else
            local paketosd = playmap[1].osd:get_osdbit(1000)
            paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Perfect " .. player[1]:get_name() .. ", but you are much to quick! First of all you have to derminate the enemy, then you can unload cargo! See you later!", 10, 4, 1)
          end
        end
      end
    end
  end
end

