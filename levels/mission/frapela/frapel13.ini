-- Frapela 13
-- INI-Datei
-- created by GS-Map-Editor v. 0.7
-- und Frapela
-- 11. Oktober 2004

globals.score_per_second = 1
globals.extra_amount     = 0

objects:add( 301, images:load("./frapela/wasser.tga"),  864, 1730, 0, math.random( 4, 6 ) )
objects:add( 302, images:load("./frapela/wasser.tga"),  878, 1730, 0, math.random( 4, 6 ) )
ziegel = objects:add( 300, images:load("./frapela/ziegel.tga"), 1, 1 )

mybase = bases:add(  0, PLAYER_BASE, 1568, 1316 )

mybase = bases:add(  1, CARGO_BASE,  541,  740 )
mybase : set_cargo_type( CARGO_OBJECT )
mybase : set_cargo_object( ziegel )
mybase : set_cargo_weight( 10 )
if (LANGUAGE == LANG_DE) then
  mybase : set_cargo_name("ein Ziegelstein")
else
  mybase : set_cargo_name("a brick")
end
mybase = bases:add(  2, CARGO_BASE,  590, 1724 )
mybase : set_cargo_type( CARGO_OBJECT )
mybase : set_cargo_object( ziegel )
mybase : set_cargo_weight( 10 )
if (LANGUAGE == LANG_DE) then
  mybase : set_cargo_name("ein Ziegelstein")
else
  mybase : set_cargo_name("a brick")
end
mybase = bases:add(  3, CARGO_BASE, 2026, 2084 )
mybase : set_cargo_type( CARGO_OBJECT )
mybase : set_cargo_object( ziegel )
mybase : set_cargo_weight( 10 )
if (LANGUAGE == LANG_DE) then
  mybase : set_cargo_name("ein Ziegelstein")
else
  mybase : set_cargo_name("a brick")
end

-- Frachtfunktionen einbinden
frachtgewicht = 30
function hook_player_returns_cargo_0( pl )
  frachtgewicht = frachtgewicht - pl:get_weight()
  if frachtgewicht <= 0 then
    local hilfs_osd = playmap[1].osd:get_osdbit(1000)
    hilfs_osd:clear()
    pl:set_mission_status( 1 )
  end
  local pakete = frachtgewicht / 10
  if pakete >= 1 then
    local paketosd = playmap[1].osd:get_osdbit(1000)
    if (LANGUAGE == LANG_DE) then
      zufi = math.random( 1, 13)
      if     zufi ==  1 then
        ausruf = "Na endlich"
      elseif zufi ==  2 then
        ausruf = "Na also"
      elseif zufi ==  3 then
        ausruf = "Nun denn"
      elseif zufi ==  4 then
        ausruf = "Nun mach schon"
      elseif zufi ==  5 then
        ausruf = "Na siehst du"
      elseif zufi ==  6 then
        ausruf = "Klasse"
      elseif zufi ==  7 then
        ausruf = "Perfekt"
      elseif zufi ==  8 then
        ausruf = "Super"
      elseif zufi ==  9 then
        ausruf = "Nun gut"
      elseif zufi == 10 then
        ausruf = "Sauber"
      elseif zufi == 11 then
        ausruf = "Spitze"
      elseif zufi == 12 then
        ausruf = "Toll"
      elseif zufi == 13 then
        ausruf = "Bravo"
      end
      if pakete >= 2 then
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]" .. ausruf .. ", " .. player[1]:get_name() .. "! Es sind noch [c:orange]".. pakete.."[c:yellow] Ziegelsteine einzusammeln! Also hau' rein!", 30, 4, 1)
      else
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]" .. ausruf .. ", " .. player[1]:get_name() .. "! Es ist nur noch [c:orange]ein[c:yellow] Ziegelstein einzusammeln! Konzentrier' dich!", 30, 4, 1)
      end
    else 
      if pakete >= 2 then
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Super " .. player[1]:get_name() .. "! Now you only must fetch [c:white]".. pakete.."[c:yellow] bricks! Go on!", 30, 5, 0)
      else
        paketosd:draw_typewriter_text("[center][f:impact10][c:yellow]Super " .. player[1]:get_name() .. "! Now you only must fetch [c:white]one[c:yellow] brick! Concentration please!", 30, 5, 0)
      end
    end 
  end
end
function hook_player_dead_0( pl )
  if pl:get_weight() > 0 then
    pl:set_mission_status( -1 )
  end
end

myob = objects:add_special(  0, SPOBJ_EXTRA, 1472,  642, 1 )
myob = objects:add_special(  1, SPOBJ_EXTRA, 2481, 1985, 1 )

myen = enemies:add( 1, E_TOWER_THREE,  1701, 1976, 0,       40, 800, 2, 40 )
myen = enemies:add( 2, E_TOWER_SINGLE,  810,  735, 0, D_UP, 20, 500, 3, 40 )
myen = enemies:add( 3, E_TOWER_SINGLE,  708, 1719, 0, D_UP, 30, 500, 2, 40 )

myen = enemies:add( 4, E_SHIP_BLUE1, 2098, 1899, 0, math.random( 40, 70 ), 1200, 3, 40 )
for n = 1, 20 do
  myen.wp:add( math.random( 2098, 2204 ), math.random( 1899, 2061 ), math.random() + 0.9, 0 )
end
myen = enemies:add( 5, E_SHIP_BLUE1, 1432, 1706, 0, math.random( 40, 70 ), 1200, 3, 40 )
for n = 1, 20 do
  myen.wp:add( math.random( 1432, 1683 ), math.random( 1706, 1917 ), math.random() + 0.9, 0 )
end
myen = enemies:add( 6, E_SHIP_BLUE1,  964, 1155, 0, math.random( 40, 70 ), 1200, 3, 40 )
for n = 1, 20 do
  myen.wp:add( math.random(  964, 1273 ), math.random( 1155, 1437 ), math.random() + 0.9, 0 )
end
myen = enemies:add( 7, E_SHIP_BLUE2,  867,  508, 0, math.random( 40, 70 ), 1200, 3, 40 )
for n = 1, 20 do
  myen.wp:add( math.random(  867, 1091 ), math.random(  508, 1100 ), math.random() + 0.9, 0 )
end

function frapela13()
  if ( player[1]:get_thrust() == 1 ) and ( player[1]:get_dead() == 0 ) then
    flug_richtung = player[1]:get_head()
    local n
    for n = 1, 360 do
      if flug_richtung <= n then
        if     n <=  90 then
          plasma_x_geschw = 0  + ( n * 2/90 )
          plasma_y_geschw = -2 + ( n * 2/90 )
        elseif n <= 180 then
          plasma_x_geschw = 2  - ( (n-90) * 2/90 )
          plasma_y_geschw = 0  + ( (n-90) * 2/90 )
        elseif n <= 270 then
          plasma_x_geschw = 0  - ( (n-180) * 2/90 )
          plasma_y_geschw = 2  - ( (n-180) * 2/90 )
        elseif n <= 360 then
          plasma_x_geschw = -2 + ( (n-270) * 2/90 )
          plasma_y_geschw = 0  - ( (n-270) * 2/90 )
        end
        plasma_beschl = player[1]:get_ship_value( PV_ACCELERATION ) / 10
        plasma_x_geschw = plasma_x_geschw * -plasma_beschl
        plasma_y_geschw = plasma_y_geschw * -plasma_beschl
        plasma_x_pos = player[1]:get_x() + (player[1]:get_width()/2)
        plasma_y_pos = player[1]:get_y() + (player[1]:get_height()/2)
        if math.random() < 0.7 then
          effects.pixels:add (      1, plasma_x_pos, plasma_y_pos,       1,       1, plasma_x_geschw, plasma_y_geschw,    20,    PIX_RED,       10,       10 )
          --     .pixels:add ( anzahl,       startx,       starty, xradius, yradius,             xab,             yab, speed,       type, maxtable, lifetime, fadespeed, max_xab, max_yab )
        else
          effects.pixels:add (      1, plasma_x_pos, plasma_y_pos,       1,       1, plasma_x_geschw, plasma_y_geschw,    20, PIX_YELLOW,       10,       10 )
          --     .pixels:add ( anzahl,       startx,       starty, xradius, yradius,             xab,             yab, speed,       type, maxtable, lifetime, fadespeed, max_xab, max_yab )
        end
        break
      end
    end
  end
end

